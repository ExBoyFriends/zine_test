<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
<title>Digital ZINE Demo</title>
<style>
body {
  margin: 0;
  background: #111;
  overflow: hidden;
}

#zine {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  touch-action: pan-y;
}

.page {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #000;
}

.page img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
  user-select: none;
  -webkit-user-drag: none;
}

/* 左右 */
#left { left: 0; }
#right { right: 0; }

/* 縦向き：左ページだけ */
.portrait #right { display: none; }
.portrait #left { width: 100%; }
</style>
</head>
<body>

<div id="zine">
<div id="left" class="page">
<img id="leftImg" src="">
</div>
<div id="right" class="page">
<img id="rightImg" src="">
</div>
</div>

<script>
const pages = [
  { left:"https://picsum.photos/800/1200?1", right:"https://picsum.photos/800/1200?2", spread:false },
  { left:"https://picsum.photos/1600/1200?3", right:"https://picsum.photos/1600/1200?3", spread:true },
  { left:"https://picsum.photos/800/1200?4", right:"https://picsum.photos/800/1200?5", spread:false }
];

let index = 0;
let startX = 0;
let currentX = 0;
let dragging = false;

const zine = document.getElementById("zine");
const left = document.getElementById("left");
const right = document.getElementById("right");
const leftImg = document.getElementById("leftImg");
const rightImg = document.getElementById("rightImg");

function isPortrait(){
  return window.innerHeight > window.innerWidth;
}

function render(){
  const p = pages[index];
  leftImg.src = p.left;
  rightImg.src = p.right;

  document.body.classList.toggle("portrait", isPortrait());

  left.style.transform = "translateX(0)";
  right.style.transform = "translateX(0)";
}
window.addEventListener("resize", render);
render();

/* ===== タッチ ===== */

zine.addEventListener("touchstart", e=>{
  startX = e.touches[0].clientX;
  currentX = startX;
  dragging = true;
});

zine.addEventListener("touchmove", e=>{
  if(!dragging) return;
  currentX = e.touches[0].clientX;
  const dx = currentX - startX;
  const page = pages[index];

  // 縦＋見開き1枚絵 → 画像ドラッグ
  if(isPortrait() && page.spread){
    e.preventDefault();
    leftImg.style.transform = `translateX(${dx}px)`;
    return;
  }

  // 通常：ページ全体を引っ張る
  e.preventDefault();
  left.style.transform = `translateX(${dx}px)`;
  right.style.transform = `translateX(${dx}px)`;
});

zine.addEventListener("touchend", ()=>{
  dragging = false;
  const dx = currentX - startX;
  const threshold = window.innerWidth * 0.25;
  const page = pages[index];

  // 縦＋見開き1枚絵 → 元に戻すだけ
  if(isPortrait() && page.spread){
    leftImg.style.transition = "transform .3s";
    leftImg.style.transform = "translateX(0)";
    setTimeout(()=> leftImg.style.transition="",300);
    return;
  }

  // ページ確定判定
  if(dx < -threshold && index < pages.length-1){
    index++;
  }
  else if(dx > threshold && index > 0){
    index--;
  }

  // 元に戻すアニメ
  left.style.transition = "transform .3s ease";
  right.style.transition = "transform .3s ease";
  left.style.transform = "translateX(0)";
  right.style.transform = "translateX(0)";
  setTimeout(()=>{
    left.style.transition="";
    right.style.transition="";
    render();
  },300);
});
</script>

</body>
</html>
