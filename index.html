<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZINE Viewer</title>

<style>
body {
  margin: 0;
  background: #000;
  overflow: hidden;
}

#viewer {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  touch-action: none;
}

/* 作品画像 */
#image {
  position: absolute;
  top: 50%;
  left: 0;
  transform: translate(0, -50%);
  user-select: none;
  -webkit-user-drag: none;
  will-change: transform;
}
</style>
</head>

<body>

<div id="viewer">
  <img id="image" src="https://picsum.photos/2000/1200">
</div>

<script>
const viewer = document.getElementById("viewer");
const img = document.getElementById("image");

let startX = 0;
let offsetX = 0;
let dragging = false;

let imgDisplayWidth = 0;  // 画面上での画像幅（基準）
let maxOffset = 0;        // 右端までの移動量

function isPortrait() {
  return window.innerHeight > window.innerWidth;
}

function setupLayout() {
  const vw = viewer.clientWidth;
  const vh = viewer.clientHeight;
  const iw = img.naturalWidth;
  const ih = img.naturalHeight;

  if (!iw || !ih) return;

  if (isPortrait()) {
    // 縦型：横型での表示幅 × 2 を想定
    const scale = vh / ih;                 // 高さ基準
    imgDisplayWidth = iw * scale;

    img.style.width = imgDisplayWidth + "px";
    img.style.height = "auto";

    offsetX = 0; // 左半分から開始
    maxOffset = vw - imgDisplayWidth; // 右半分の限界
    applyTransform(offsetX);

  } else {
    // 横型：全体が必ず収まる（contain）
    const scale = Math.min(vw / iw, vh / ih);
    const w = iw * scale;
    const h = ih * scale;

    img.style.width = w + "px";
    img.style.height = h + "px";

    img.style.left = "50%";
    img.style.top = "50%";
    img.style.transform = "translate(-50%, -50%)";

    offsetX = 0;
    maxOffset = 0;
  }
}

function applyTransform(x) {
  // 左端ストッパー：0
  // 右端ストッパー：maxOffset（マイナス値）
  x = Math.max(maxOffset, Math.min(0, x));
  img.style.left = "0";
  img.style.top = "50%";
  img.style.transform = `translate(${x}px, -50%)`;
}

img.onload = () => {
  setupLayout();
};

window.addEventListener("resize", setupLayout);

/* ===== タッチ操作（縦型のみ） ===== */

viewer.addEventListener("touchstart", e => {
  if (!isPortrait()) return;
  dragging = true;
  startX = e.touches[0].clientX;
});

viewer.addEventListener("touchmove", e => {
  if (!dragging || !isPortrait()) return;
  e.preventDefault();

  const dx = e.touches[0].clientX - startX;
  applyTransform(offsetX + dx);
});

viewer.addEventListener("touchend", e => {
  if (!isPortrait()) return;
  dragging = false;

  // 現在位置を固定
  const match = /translate\(([-0-9.]+)px/.exec(img.style.transform);
  if (match) {
    offsetX = parseFloat(match[1]);
  }
});
</script>

</body>
</html>