<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZINE Viewer</title>

<style>
body {
  margin: 0;
  background: #000;
  overflow: hidden;
}

#viewer {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  touch-action: none;
}

#image {
  position: absolute;
  top: 50%;
  left: 0;
  transform: translate(0, -50%);
  user-select: none;
  -webkit-user-drag: none;
  will-change: transform;
}
</style>
</head>

<body>

<div id="viewer">
  <!-- 自分の作品画像に変更 -->
  <img id="image" src="https://picsum.photos/2000/1200">
</div>

<script>
const viewer = document.getElementById("viewer");
const img = document.getElementById("image");

let startX = 0;
let offsetX = 0;
let dragging = false;

// 横向きで収まったときの画像表示サイズ
let displayWidth = 0;
let displayHeight = 0;

// 縦向きで動かせる最大量（マイナス値）
let minOffsetX = 0;

function isPortrait() {
  return window.innerHeight > window.innerWidth;
}

function setupLayout() {
  const vw = viewer.clientWidth;
  const vh = viewer.clientHeight;
  const iw = img.naturalWidth;
  const ih = img.naturalHeight;

  if (!iw || !ih) return;

  /* まず必ず「横向きで全体が収まるサイズ」を計算 */
  const scale = Math.min(vw / iw, vh / ih);
  displayWidth  = iw * scale;
  displayHeight = ih * scale;

  img.style.width  = displayWidth + "px";
  img.style.height = displayHeight + "px";

  if (isPortrait()) {
    // 縦向き：左半分だけ見える
    img.style.left = "0";
    img.style.top  = "50%";

    // 右端まで動かせる量
    minOffsetX = vw - displayWidth;  // マイナス値

    // 初期位置：左半分
    offsetX = 0;
    applyTransform(offsetX);

  } else {
    // 横向き：全体を中央にフィット
    img.style.left = "50%";
    img.style.top  = "50%";
    img.style.transform = "translate(-50%, -50%)";

    offsetX = 0;
    minOffsetX = 0;
  }
}

function applyTransform(x) {
  // 範囲制限
  x = Math.max(minOffsetX, Math.min(0, x));
  img.style.transform = `translate(${x}px, -50%)`;
}

/* 画像ロード時と回転時 */
img.onload = setupLayout;
window.addEventListener("resize", setupLayout);

/* ===== タッチ操作（縦向きのみ） ===== */

viewer.addEventListener("touchstart", e => {
  if (!isPortrait()) return;
  dragging = true;
  startX = e.touches[0].clientX;
});

viewer.addEventListener("touchmove", e => {
  if (!dragging || !isPortrait()) return;
  e.preventDefault();

  const dx = e.touches[0].clientX - startX;
  applyTransform(offsetX + dx);
});

viewer.addEventListener("touchend", () => {
  if (!isPortrait()) return;
  dragging = false;

  // 現在位置を保存（戻らない）
  const match = /translate\(([-0-9.]+)px/.exec(img.style.transform);
  if (match) {
    offsetX = parseFloat(match[1]);
  }
});
</script>

</body>
</html>