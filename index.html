<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
html,body{
  margin:0;
  background:#000;
  overflow:hidden;
}
#viewer{
  width:100vw;
  height:100vh;
  position:relative;
  overflow:hidden;
  touch-action:none;
}
#image{
  position:absolute;
  top:50%;
  left:0;
  transform:translate(0,-50%);
  user-select:none;
  -webkit-user-drag:none;
}
</style>
</head>
<body>

<div id="viewer">
  <!-- 正方形画像を指定 -->
  <img id="image" src="https://picsum.photos/2000">
</div>

<script>
const viewer = document.getElementById("viewer");
const img = document.getElementById("image");

let offsetX = 0;
let startX = 0;
let dragging = false;
let minOffsetX = 0;
let lastOrientation = null;

function isPortrait() {
  return window.innerHeight > window.innerWidth;
}

/* 位置適用 */
function apply(x) {
  x = Math.max(minOffsetX, Math.min(0, x));
  img.style.transform = `translate(${x}px, -50%)`;
}

/* 向きごとの完全初期化レイアウト */
function setup() {
  const vw = viewer.clientWidth;
  const vh = viewer.clientHeight;

  let size;

  if (isPortrait()) {
    // 縦型：必ずはみ出させる
    size = vw * 1.4;

    img.style.width = size + "px";
    img.style.height = size + "px";

    img.style.left = "0";
    img.style.top = "50%";

    // 縦型は毎回リセット
    offsetX = 0;
    minOffsetX = vw - size;   // 必ずマイナス

    apply(offsetX);

  } else {
    // 横型：必ず全体が収まる
    size = Math.min(vw, vh);

    img.style.width = size + "px";
    img.style.height = size + "px";

    img.style.left = "50%";
    img.style.top = "50%";
    img.style.transform = "translate(-50%, -50%)";

    // 横型は完全固定
    offsetX = 0;
    minOffsetX = 0;
  }
}

/* 向き変化検出 */
function checkOrientation() {
  const now = isPortrait() ? "portrait" : "landscape";
  if (now !== lastOrientation) {
    lastOrientation = now;
    setup();
  }
}

/* タッチ操作（縦型のみ有効） */
viewer.addEventListener("touchstart", e => {
  if (!isPortrait()) return;
  dragging = true;
  startX = e.touches[0].clientX;
});

viewer.addEventListener("touchmove", e => {
  if (!dragging || !isPortrait()) return;
  e.preventDefault();
  const dx = e.touches[0].clientX - startX;
  apply(offsetX + dx);
});

viewer.addEventListener("touchend", () => {
  if (!dragging || !isPortrait()) return;
  dragging = false;
  const m = /translate\(([-\d.]+)px/.exec(img.style.transform);
  if (m) offsetX = parseFloat(m[1]);
});

/* 初期化 */
img.onload = () => {
  lastOrientation = isPortrait() ? "portrait" : "landscape";
  setup();
};

window.addEventListener("resize", checkOrientation);


</script>

</body>
</html>